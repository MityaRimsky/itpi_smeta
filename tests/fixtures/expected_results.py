"""
Эталонные данные из реальных смет для тестирования
Извлечены из файлов в папке smeta_examples/
"""

# ============================================
# СМЕТА 1: Каширская ГРЭС (123 га)
# ============================================
KASHIRSKAYA_GRES = {
    "name": "Каширская ГРЭС",
    "description": "Промпредприятие, спецрежим, неблагоприятный период",
    "total_sbc_2001": 2571125.98,
    "index_2025": 6.87,
    "total_with_index": 17663635.48,
    
    "field_works": [
        {
            "name": "Создание инженерно-топографического плана м-ба 1:500, высота сечения рельефа 0,5м (II кат., пром.предприятие) со съемкой подземных коммуникаций. Специальный режим территории.",
            "category": "II",
            "unit": "га",
            "quantity": 97,
            "table_ref": "т. 9, п. 5, прим 4; п.8 в) ОУ",
            "base_price": 4632,
            "K1": 1.75,  # промпредприятие + подземные коммуникации
            "K2": 1.0,
            "K3": 1.25,  # спецрежим
            "expected_cost": 982852.5
        },
        {
            "name": "Создание инженерно-топографического плана м-ба 1:500, высота сечения рельефа 0,5м (III кат., незастроенная) со съемкой подземных коммуникаций.",
            "category": "III",
            "unit": "га",
            "quantity": 26,
            "table_ref": "т. 9, п. 6, прим 4",
            "base_price": 3288,
            "K1": 1.2,  # незастроенная + подземные коммуникации
            "K2": 1.0,
            "K3": 1.0,
            "expected_cost": 102585.6
        },
        {
            "name": "Создание плановой опорной геодезической сети спутниковым методом; 2 разряд, IIкат. Специальный режим территории",
            "category": "II",
            "unit": "пункт",
            "quantity": 8,
            "table_ref": "т. 8, п. 3, прим. 2, ОУ п.8 в)",
            "base_price": 6426,
            "K1": 1.25,  # спецрежим
            "K2": 1.3,   # спутниковые системы
            "K3": 1.0,
            "expected_cost": 83538.0
        }
    ],
    "field_total": 1544329.93,
    
    "office_works": [
        {
            "name": "Создание инженерно-топографического плана м-ба 1:500 сечение рельефа 0,5 (съемка подземных коммуникаций) территория пром.предприятия, IIкат. (с применением компьютерных технологий)",
            "category": "II",
            "unit": "га",
            "quantity": 97,
            "table_ref": "т. 9, п. 5, прим.4, ОУ 15д",
            "base_price": 1938,
            "K1": 1.75,
            "K2": 1.2,  # компьютерные технологии
            "K3": 1.0,
            "expected_cost": 394770.6
        }
    ],
    "office_total": 455153.64,
    
    "addons": [
        {"name": "Внутренний транспорт (до 5 км)", "rate": 0.0375, "base": 1544329.93, "expected": 57912.37},
        {"name": "Внешний транспорт (100-300 км, до 3 мес)", "rate": 0.127, "base": 1602242.30},
        {"name": "Организация и ликвидация", "rate": 0.06, "base": 1602242.30, "expected": 154046.91},
        {"name": "Регистрация ИСОГД", "fixed": 56250}
    ],
    "addons_total": 571642.41,
    
    "params": {
        "territory_type": "промпредприятие",
        "has_underground_comms": True,
        "special_regime": True,
        "unfavorable_months": 6,  # неблагоприятный период
        "use_computer": True,
        "distance_to_base": 5,
        "external_distance": 200,
        "expedition_duration": 3
    }
}

# ============================================
# СМЕТА 2: Омск (2 га)
# ============================================
OMSK = {
    "name": "Омск",
    "description": "Сезонный коэфф. 30%, районный 8%, внешний транспорт >2000км",
    "total_sbc_2001": 120113.26,
    "index_2025": 6.87,
    "total_with_index": 825178.1,
    
    "field_works": [
        {
            "name": "Создание плановой опорной геодезической сети; 2 разряд, IIкат.",
            "category": "II",
            "unit": "пункт",
            "quantity": 2,
            "table_ref": "т. 8, п. 3, прим.1,2",
            "base_price": 6426,
            "K1": 1.0,
            "K2": 1.3,  # спутниковые системы
            "K3": 1.0,
            "expected_cost": 16707.6
        },
        {
            "name": "Создание высотной опорной геодезической сети; IV класс, IIкат.",
            "category": "II",
            "unit": "пункт",
            "quantity": 2,
            "table_ref": "т. 8, п. 4, прим. 1",
            "base_price": 1897,
            "K1": 1.0,
            "K2": 1.0,
            "K3": 1.0,
            "expected_cost": 3794.0
        },
        {
            "name": "Создание инженерно-топографического плана м-ба 1:500 сечение рельефа 0,5 (съемка подземных коммуникаций, составление эскизов опор ВЛ) действующее пром предприятие, Ш кат.",
            "category": "III",
            "unit": "га",
            "quantity": 2,
            "table_ref": "т. 9, п. 5, прим.4",
            "base_price": 6195,
            "K1": 1.75,  # промпредприятие
            "K2": 1.3,   # эскизы опор
            "K3": 1.0,
            "expected_cost": 28141.25
        }
    ],
    "field_total": 48942.85,
    
    "office_total": 16755.74,
    
    "addons": [
        {"name": "Сезонное удорожание (6-7.5 мес)", "rate": 0.30, "base": 48942.85, "expected": 14682.86},
        {"name": "Районное удорожание (1.15)", "rate": 0.08},
        {"name": "Внутренний транспорт (до 5 км)", "rate": 0.0875},
        {"name": "Внешний транспорт (>2000 км, 2 мес)", "rate": 0.392, "base": 53225.35},
        {"name": "Организация и ликвидация (K=2)", "rate": 0.12, "base": 53225.35, "expected": 10669.54}
    ],
    "addons_total": 54414.67,
    
    "params": {
        "territory_type": "промпредприятие",
        "has_underground_comms": True,
        "has_detailed_wells_sketches": True,  # эскизы опор ВЛ
        "unfavorable_months": 7,  # 30% = 6-7.5 мес
        "salary_coeff": 1.15,  # районный коэфф
        "use_computer": True,
        "color_plan": True,
        "distance_to_base": 5,
        "external_distance": 2500,
        "expedition_duration": 2
    }
}

# ============================================
# СМЕТА 3: АМУР (1000+250 га)
# ============================================
AMUR = {
    "name": "АМУР",
    "description": "Обновление, спецрежим 25%, промежуточные материалы",
    "total_sbc_2001": 16097151.88,
    "index_2025": 6.54,
    "total_with_index": 105275373.3,
    
    "field_works": [
        {
            "name": "Обновление инженерно-топографического плана м-ба 1:500, высота сечения рельефа 0,5м (II кат., территория пром.предприятия) со съемкой подземных коммуникаций, с детальным обследованием эстакад/колодцев.",
            "category": "II",
            "unit": "га",
            "quantity": 1000,
            "table_ref": "т. 9, п. 5, прим.3,4,5",
            "base_price": 4632,
            "K1": 1.75,  # промпредприятие + подземные + эскизы
            "K2": 0.5,   # обновление
            "K3": 1.3,   # детальное обследование
            "expected_cost": 5268900.0
        },
        {
            "name": "Обновление инженерно-топографического плана м-ба 1:2000, высота сечения рельефа 0,5м (II кат., территория пром.предприятия) со съемкой подземных коммуникаций, с детальным обследованием эстакад/колодцев.",
            "category": "II",
            "unit": "га",
            "quantity": 250,
            "table_ref": "т. 9, п. 17, прим.3,4,5",
            "base_price": 2796,
            "K1": 1.75,
            "K2": 0.5,
            "K3": 1.3,
            "expected_cost": 795112.5
        }
    ],
    "field_total": 6130077.1,
    
    "office_total": 3141005.0,
    
    "addons": [
        {"name": "Промежуточные материалы", "rate": 0.10, "base": 9271082.1, "expected": 927108.21},
        {"name": "Внутренний транспорт (15-20 км)", "rate": 0.1125, "base": 6130077.1, "expected": 689633.67},
        {"name": "Внешний транспорт (>2000 км, 3 мес)", "rate": 0.364, "base": 6819710.77},
        {"name": "Организация и ликвидация", "rate": 0.06, "base": 6819710.77, "expected": 409182.65},
        {"name": "Спецрежим территории", "rate": 0.25, "base": 9271082.1, "expected": 2317770.53}
    ],
    "addons_total": 6826069.78,
    
    "params": {
        "territory_type": "промпредприятие",
        "has_underground_comms": True,
        "has_detailed_wells_sketches": True,
        "update_mode": True,  # обновление
        "special_regime": True,
        "intermediate_materials": True,
        "use_computer": True,
        "distance_to_base": 17,
        "external_distance": 2500,
        "expedition_duration": 3
    }
}

# ============================================
# СМЕТА 4: Москва (4.4 га)
# ============================================
MOSCOW = {
    "name": "Москва",
    "description": "Застроенная, небольшие участки до 5 га, подеревная съемка",
    "total_sbc_2001": 73336.62,
    "index_2025": 6.7,
    "total_with_index": 491355.35,
    
    "field_works": [
        {
            "name": "Создание инженерно-топографического плана м-ба 1:500 сечение рельефа 0,5 (съемка подземных коммуникаций; небольшие участки до 5 га) территория застроенная, IIкат.",
            "category": "II",
            "unit": "га",
            "quantity": 4.4,
            "table_ref": "т. 9, п. 5, прим.4, табл.10, п.1",
            "base_price": 3284,
            "K1": 1.55,  # застроенная + небольшие участки
            "K2": 1.2,   # подземные коммуникации
            "K3": 1.0,
            "expected_cost": 26876.26
        },
        {
            "name": "Выполнение подеревной съемки",
            "category": "II",
            "unit": "га",
            "quantity": 4.4,
            "table_ref": "т. 9, п. 5, Глава 2, п.5",
            "base_price": 3284,
            "K1": 0.7,  # подеревная съемка
            "K2": 1.0,
            "K3": 1.0,
            "expected_cost": 10114.72
        }
    ],
    "field_total": 36990.98,
    
    "office_works": [
        {
            "name": "Создание инженерно-топографического плана м-ба 1:500 сечение рельефа 0,5 (съемка подземных коммуникаций) территория застроенная (составление плана в цвете, с применением компьютерных технологий), IIкат.",
            "category": "II",
            "unit": "га",
            "quantity": 4.4,
            "table_ref": "т. 9, п. 5, прим.4, ОУ 15г,д",
            "base_price": 1067,
            "K1": 1.55,
            "K2": 1.1,  # цвет
            "K3": 1.2,  # компьютер
            "expected_cost": 9605.56
        }
    ],
    "office_total": 17305.92,
    
    "addons": [
        {"name": "Внутренний транспорт (15-20 км)", "rate": 0.1625, "base": 36990.98, "expected": 6011.03},
        {"name": "Организация и ликвидация (K=2)", "rate": 0.12, "base": 43002.01, "expected": 11171.27},
        {"name": "Регистрация", "fixed": 1750, "expected": 1857.42}
    ],
    "addons_total": 19039.72,
    
    "params": {
        "territory_type": "застроенная",
        "has_underground_comms": True,
        "small_area": True,  # до 5 га
        "use_computer": True,
        "color_plan": True,
        "distance_to_base": 17
    }
}

# ============================================
# СМЕТА 5: Нижнекамск (5.2 га)
# ============================================
NIZHNEKAMSK = {
    "name": "Нижнекамск",
    "description": "Застроенная, районный коэфф. 8%, промежуточные материалы",
    "total_sbc_2001": 147475.69,
    "index_2025": 6.7,
    "total_with_index": 988087.12,
    
    "field_works": [
        {
            "name": "Создание инженерно-топографического плана м-ба 1:500 сечение рельефа 0,5 (съемка подземных коммуникаций) территория застроенная, Iкат.",
            "category": "I",
            "unit": "га",
            "quantity": 5.2,
            "table_ref": "т. 9, п. 4, прим.4",
            "base_price": 2233,
            "K1": 1.5,  # застроенная
            "K2": 1.0,
            "K3": 1.0,
            "expected_cost": 17417.4
        },
        {
            "name": "Создание плановой опорной геодезической сети спутниковым методом; 2 разряд, IIкат.",
            "category": "II",
            "unit": "пункт",
            "quantity": 3,
            "table_ref": "т. 8, п. 3, прим. 2",
            "base_price": 6426,
            "K1": 1.0,
            "K2": 1.3,  # спутниковые системы
            "K3": 1.0,
            "expected_cost": 25061.4
        }
    ],
    "field_total": 50599.8,
    
    "office_works": [
        {
            "name": "Создание инженерно-топографического плана м-ба 1:500 сечение рельефа 0,5 (съемка подземных коммуникаций) территория застроенная (составление плана в цвете, с применением компьютерных технологий), Iкат.",
            "category": "I",
            "unit": "га",
            "quantity": 5.2,
            "table_ref": "т. 9, п. 4, прим.4, ОУ 15г,д",
            "base_price": 737,
            "K1": 1.55,
            "K2": 1.1,  # цвет
            "K3": 1.2,  # компьютер
            "expected_cost": 7841.09
        }
    ],
    "office_total": 21219.09,
    
    "addons": [
        {"name": "Внутренний транспорт (до 5 км)", "rate": 0.0875, "base": 50599.8, "expected": 4427.48},
        {"name": "Внешний транспорт (1000-2000 км, 1 мес)", "rate": 0.364, "base": 55027.28},
        {"name": "Организация и ликвидация (K=2)", "rate": 0.12, "base": 55027.28, "expected": 11030.75},
        {"name": "Районное удорожание (1.15)", "rate": 0.08, "base": 50599.8, "expected": 24077.91},
        {"name": "Промежуточные материалы", "rate": 0.10, "expected": 16090.73}
    ],
    "addons_total": 75656.8,
    
    "params": {
        "territory_type": "застроенная",
        "has_underground_comms": True,
        "salary_coeff": 1.15,
        "intermediate_materials": True,
        "use_computer": True,
        "color_plan": True,
        "distance_to_base": 5,
        "external_distance": 1500,
        "expedition_duration": 1
    }
}

# ============================================
# СМЕТА 6: Магадан (1420 га)
# ============================================
MAGADAN = {
    "name": "Магадан",
    "description": "Крайний Север, горные районы 10%, районный 35%, орг.ликвидация K=2.5",
    "total_sbc_2001": 2973677.74,
    "index_2025": 6.54,
    "total_with_index": 19447852.42,
    
    "field_works": [
        {
            "name": "Создание инженерно-топографического плана м-ба 1:2000, высота сечения рельефа 2,0м (II кат., незастроенная территория)",
            "category": "II",
            "unit": "га",
            "quantity": 1420,
            "table_ref": "т. 9, п. 23",
            "base_price": 545,
            "K1": 1.0,
            "K2": 1.0,
            "K3": 1.0,
            "expected_cost": 773900.0
        },
        {
            "name": "Создание плановой опорной геодезической сети; 1 разряд с применением спутниковых систем",
            "category": "II",
            "unit": "пункт",
            "quantity": 15,
            "table_ref": "т. 8, п. 2, прим. 2",
            "base_price": 9172,
            "K1": 1.0,
            "K2": 1.3,  # спутниковые системы
            "K3": 1.0,
            "expected_cost": 178854.0
        }
    ],
    "field_total": 981209.0,
    
    "office_works": [
        {
            "name": "Создание инженерно-топографического плана м-ба 1:2000 сечение рельефа 2,0 (территория незастроенная, IIкат. (составление плана в цвете с применением компьютерных технологий)",
            "category": "II",
            "unit": "га",
            "quantity": 1420,
            "table_ref": "т. 9, п. 23, ОУ 15г, 15д",
            "base_price": 145,
            "K1": 1.0,
            "K2": 1.2,  # компьютер
            "K3": 1.1,  # цвет
            "expected_cost": 271788.0
        }
    ],
    "office_total": 334593.0,
    
    "addons": [
        {"name": "Горные районы (1500-1700м)", "rate": 0.10, "base": 981209.0, "expected": 98120.9},
        {"name": "Промежуточные материалы", "rate": 0.10, "base": 1413922.9, "expected": 141392.29},
        {"name": "Внутренний транспорт (до 5 км)", "rate": 0.0375, "base": 1079329.9, "expected": 40474.87},
        {"name": "Внешний транспорт (>2000 км, 2 мес)", "rate": 0.392, "base": 1119804.77},
        {"name": "Организация и ликвидация (K=2.5)", "rate": 0.15, "base": 1119804.77, "expected": 167970.72},
        {"name": "Районное удорожание Крайний Север", "rate": 0.35, "base": 2202724.25, "expected": 770953.49}
    ],
    "addons_total": 1657875.74,
    
    "params": {
        "territory_type": "незастроенная",
        "region_type": "far_north",  # Крайний Север
        "altitude": 1600,  # горные районы
        "salary_coeff": 1.70,  # районный коэфф
        "intermediate_materials": True,
        "use_computer": True,
        "color_plan": True,
        "distance_to_base": 5,
        "external_distance": 2500,
        "expedition_duration": 2
    }
}

# Список всех смет для тестирования
ALL_ESTIMATES = [
    KASHIRSKAYA_GRES,
    OMSK,
    AMUR,
    MOSCOW,
    NIZHNEKAMSK,
    MAGADAN
]

# Правила выбора коэффициентов K1 (для проверки)
K1_RULES = {
    "territory_type": {
        "промпредприятие": 1.75,
        "застроенная": 1.5,
        "незастроенная": 1.2
    },
    "small_area_up_to_5ha": 1.55,  # табл.10, п.1
    "update_mode": 0.5,  # прим.3 к табл.9
    "detailed_wells_sketches": 1.3,  # прим.5 к табл.9
    "tree_survey": 0.7,  # подеревная съемка
    "satellite_systems": 1.3,  # прим.2 к табл.8
    "no_center_fixation": {
        "planimetric": 0.7,  # без закрепления центра
        "altimetric": 0.4
    }
}

# Правила выбора коэффициентов K2 (для проверки)
K2_RULES = {
    "computer_tech": 1.2,  # п.15д
    "color_plan": 1.1,  # п.15г
    "dual_format": 1.75,  # п.15е (конфликт с computer_tech!)
    "intermediate_materials": 1.1,  # п.15а
    "classified_materials": 1.1,  # п.15б
    "artificial_lighting": 1.15  # п.15в
}

# Правила выбора коэффициентов K3 (для проверки)
K3_RULES = {
    "special_regime": 1.25,  # п.8в
    "night_time": 1.35,  # п.8в
    "unfavorable_period": {
        (4, 5.5): 1.2,
        (6, 7.5): 1.3,
        (8, 9.5): 1.4
    },
    "mountain_regions": {
        (1500, 1700): 1.1,
        (1700, 2000): 1.15,
        (2000, 3000): 1.2,
        (3000, None): 1.25
    }
}

# Правила надбавок (для проверки)
ADDON_RULES = {
    "internal_transport": {
        # (distance_min, distance_max): {(cost_min, cost_max): rate}
        (0, 5): {(0, 30000): 0.0875, (30000, 75000): 0.0625, (75000, 150000): 0.05, (150000, None): 0.0375},
        (5, 10): {(0, 30000): 0.1125, (30000, 75000): 0.0875, (75000, 150000): 0.0625, (150000, None): 0.05},
        (10, 15): {(0, 30000): 0.1375, (30000, 75000): 0.1125, (75000, 150000): 0.0875, (150000, None): 0.0625},
        (15, 20): {(0, 30000): 0.1625, (30000, 75000): 0.1375, (75000, 150000): 0.1125, (150000, None): 0.0875}
    },
    "org_liquidation": {
        "base_rate": 0.06,
        "coefficients": {
            (0, 30000): 2.5,
            (30000, 75000): 2.0,
            (75000, 150000): 1.5,
            (150000, None): 1.0
        },
        "far_north_coeff": 2.5
    },
    "seasonal": {
        (4, 5.5): 0.20,
        (6, 7.5): 0.30,
        (8, 9.5): 0.40
    },
    "regional": {
        1.05: 0.05,
        1.15: 0.08,
        1.20: 0.10,
        1.30: 0.15,
        1.40: 0.20,
        1.50: 0.25,
        1.60: 0.30,
        1.70: 0.35,
        1.80: 0.40,
        2.00: 0.50
    },
    "far_north": 0.50,
    "far_north_equivalent": 0.25,
    "south_regions": 0.15,
    "mountain": {
        (1500, 1700): 0.10,
        (1700, 2000): 0.15,
        (2000, 3000): 0.20,
        (3000, None): 0.25
    },
    "intermediate_materials": 0.10,
    "special_regime": 0.25
}
